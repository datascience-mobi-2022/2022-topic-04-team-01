---
title: "Final Report"
author: "Gruppe 4"
date: '2022-07-03'
bibliography: references.bib
output: 
  html_document:
    number_sections: TRUE
    toc: TRUE
    theme: united
---

```{r knitr_init, echo=FALSE, cache=FALSE}
library(knitr)
#library(rmdformats)
## Global options
#options(max.print="120")
opts_chunk$set(echo=FALSE,
	             cache=TRUE,
               prompt=FALSE,
               tidy=TRUE,
               comment=NA,
               message=FALSE,
               warning=FALSE)
#opts_knit$set(width=120)
#opts_knit$set(root.dir  = "~/")
```

```{r}
library(affy)
library(AnnotationDbi)
library(hgu133plus2hsenstprobe)
library(hgu133plus2hsenstcdf) 
library(Rcpp)
library(tidyverse)
library(vsn)
library(limma)
library(pheatmap)
library(hexbin)
library(biomaRt)
library(kableExtra)
library(Rfssa)
install.packages("remotes")
remotes::install_github("vqv/ggbiplot")
library(ggbiplot)
library(magrittr) 
library(dplyr)
library(stringr)
```

#Introduction

#Methods

## Programming language

The programming language R version 4.2.0 and its IDE RStudio were used.

## Libraries and packages

Following libraries were used:

```{r}
all_libraries <- tibble::tribble(
  ~Library...package,                        ~Version,                              ~Description,
              "affy",                              NA, "library used for unpacking the raw data",
               "vsn",                              NA,   "library for the vsn rma normalization",
     "AnnotationDbi",                              NA,                                        NA,
         "tidyverse", "library used for Datacleaning",                       "Library / package",
           "Version",                   "Description",                                    "affy"
  )

all_libraries %>%
  kable(all_libraries, digits = 3, row.names = FALSE, align = "c", caption = "Table 1: summary of all libraries used") %>%
  kable_styling(bootstrap_options = "striped", full_width = FALSE)

```

Some of them are from Bioconductor. This is a ...

## Dataset

We chose a Dataset with following criteria: Human embryonic data in the stages of organ development.

### reading in the data set

Next, the data was downloaded to a local harddrive from the Gene Expression Omnibus with the Accession Number of [GSE15744](https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE15744). The data was the read in with the help of the library Affy and is connected to the correct Annotation by the brainarray package.

```{r}
setwd("C:/Users/merke/Documents/Vorlesungen Material/SS22/DataAnalysis/project/rawdata")
data.GSE15744 <- ReadAffy()
data.GSE15744@cdfName <- "HGU133Plus2_Hs_ENST"
setwd("C:/Users/merke/Documents/Vorlesungen Material/SS22/DataAnalysis/project/report")
save(data.GSE15744, file="data.GSE15744.RData")
```

To access the data remotely, it is downloaded from the github with the Library Rfssa.

```{r}
#make data accessible for everyone
githubURL <- "https://github.com/datascience-mobi-2022/2022-topic-04-team-01/blob/main/Report/data.GSE15744.RData"
load_github_data(githubURL)
```

### normalising the data set

We used the method vsn rma normalization according to Huber et al. This method is able to deal with variance and with randomness.

```{r}
data.GSE15744.vsnrma <- vsnrma(data.GSE15744)
```

## Quality control

There are some tests to verify the data collected through the micro arrays. Also, quality control needs to check the normalization method.

### Single chip control

```{r, echo=TRUE}

for (i in 1:18) {
  image(data.GSE15744[,i], col=rainbow(100, start = 0, end = 0.75)[100:1])
} # GSM394501 looks a bit brighter, GSM394527 looks very bright
```

The surface of the chips are visible and show no spatial artefacts, fingerprints, irregular dye or stripes. Some differences in overall brightness are visible but marginal.

### meanSdPlot

The normalization can be verified by plotting the Rank of the mean against the standard deviation. The purpose of the normalization is to set the variance and the mean on an arbitrary level to reduce statistical fluctiation and randomness. This achieves comparible result. As a consequence there should be no correlation between the mean and the standard deviation, indicated by the red line.

```{r}
meanSdPlot(data.GSE15744.vsnrma, xlab="Rank (mean)", ylab="Standard Deviation")
```

### Boxplot

There boxplots show the mean and variance of all 18 chips and further verifies the normalization.

```{r}
## Before

boxplot(data.GSE15744, col = rainbow(15),
        cex.axis=0.5,
        las=2,                                            
        ylab="Relative expression",
        main="Raw Gene expression in human embryo (GSE15744, raw data)")


## After

boxplot(exprs(GSE15744.vsnrma), col = rainbow(15),
        cex.axis=0.5,
        las=2,                                            
        ylab="Relative expression",
        main="Raw Gene expression in human embryo (GSE15744, normalized)")
```

### RNA Degradation Plot

This Quality control confirm that the standard conditions of the chips are met and they are comparible in their results.

```{r}
rnadeg.raw <- AffyRNAdeg(data.GSE15744)

plotAffyRNAdeg(rnadeg.raw, col=rainbow(18))
title(sub="Human embryo (GSE15744, Raw data)")

# Not scaled
plotAffyRNAdeg(rnadeg.raw, col=rainbow(18), transform = "shift.only")
title(sub="Human embryo (GSE15744, Raw data)")
```

### Scatter plot

```{r}
# Comparison of some Scatter plots
for(i in 1:17){
  plot(eset[,c(i,i+1)], pch=".", cex=2)
  abline(0, 1, col="red")               # 45 degree dividing line
  
  title(main = paste("Scatterplot of probe", 
                     substr(colnames(GSE15744.vsnrma)[i], 1, nchar(colnames(GSE15744.vsnrma)[i])), "and", 
                     substr(colnames(GSE15744.vsnrma)[i+1], 1, nchar(colnames(GSE15744.vsnrma)[i+1])), 
                     sep=" ", collapse = NULL))
  
  file.name <- paste("C:/Users/david/Documents/Data Analysis Lokal/Plots/Scatterplots/Scatterplot_GSE15744.pdf", 
                     as.character(substr(colnames(GSE15744.vsnrma)[i], 1, nchar(colnames(GSE15744.vsnrma)[i]))), "_",
                     as.character(substr(colnames(GSE15744.vsnrma)[i+1], 1, nchar(colnames(GSE15744.vsnrma)[i+1]))),
                     ".pdf", sep="")
  
  dev.copy2pdf(file = file.name)
  dev.off()
}
```

## Data cleaning

Remove file-endings (.CEL) from sample names in Rownames and Columnames.

```{r}
filenames <- rownames(pData(data.GSE15744))
samples <- substr(filenames, 1,9)                                   # Only keeps 1st to 9th character in the string -> cuts .cel from name
rownames(pData(data.GSE15744)) = samples
rownames


orig <- colnames(exprs(data.GSE15744))
new <- substr(orig, 1, nchar(orig)-4)                               # Removes last 4 characters in the string
colnames(exprs(data.GSE15744)) = new
colnames(exprs(data.GSE15744.vsnrma)) = new

```

Convert to dataframe and cut of Affymetrix Control genes

```{r}
temp_embryo_df = as.data.frame(exprs(data.GSE15744.vsnrma))
colnames(temp_embryo_df) = rownames(pData(data.GSE15744.vsnrma))
temp_embryo_df
embryo_df = temp_embryo_df[63:95721,]
```

## Annotation

```{r}
library(RCurl)
file_annotation = getURL("https://raw.githubusercontent.com/datascience-mobi-2022/2022-topic-04-team-01/main/R%20Scripts/ensembl_103_human.txt")
ensembl = as.data.frame(read.csv(text=file_annotation, sep = ","))   # Load the ensembl annotation data
TranscriptID_orig = rownames(embryo_df)
ensembl = ensembl %>% distinct(Transcript.stable.ID, .keep_all = TRUE) # Remove duplicate transcripts


embryo_df["Transcript.stable.ID"] = gsub("[//._].*$" ,"", rownames(embryo_df)) # Add column for mergign
embryo_df_ann = left_join(embryo_df, ensembl, by="Transcript.stable.ID")   # Combine the Datasets by their Transcript ID
rownames(embryo_df_ann) <- embryo_df_ann$Transcript.stable.ID
colnames(embryo_df_ann) = c("Week4_1", "Week4_2", "Week4_3", "Week5_1", "Week5_2", "Week5_3", "Week6_1", "Week6_2", "Week6_3", "Week7_1", "Week7_2", "Week7_3", "Week8_1", "Week8_2", "Week8_3", "Week9_1", "Week9_2", "Week9_3", "Transcript.stable.ID", "Gene.stable.ID", "Chromosome.scaffold.name", "HGNC.symbol", "AFFY.HG.U133.Plus.2.probe")


file_tra = getURL("https://raw.githubusercontent.com/datascience-mobi-2022/2022-topic-04-team-01/main/R%20Scripts/tra.2017.human.gtex.5x.table.tsv")
tra_gtex = as.data.frame(read.csv(text = file_tra, sep = "\t"))
embryo_df_tra = embryo_df_ann[embryo_df_ann$Transcript.stable.ID %in% tra_gtex$ensembl.transcript ,]
embryo_df_tra = embryo_df_tra %>%  dplyr::rename(ensembl.transcript = Transcript.stable.ID)
embryo_df_tra =  left_join(embryo_df_tra, tra_gtex, by="ensembl.transcript") 


#Make Tissue names more accessible by creating a vector for them
a = separate(embryo_df_tra, tissues, into = as.character(c(1:30)), sep="/")
create_tissue_vector = function(f) {
  f = unlist(f)
  f = f[!is.na(f)]
  return(f)
}
tissues = apply(a[,31:60],1, create_tissue_vector)
tissues = sapply(tissues, unlist)
a = a[,c(1:30, 61)] 
a %>% add_column(tissues = NA)
a$tissues = tissues
embryo_df_tissues = a
```

## Data Cleaning

```{r}
embryo_df_tissues <- embryo_df_tissues[,!names(embryo_df_tissues) %in% c("ensembl.gene", "ensembl.symbol", "ensembl.chrom")] #removed duplicates


#Chromosome Spalte aufhübschen und unnötiges löschen
embryo_df_tissues$Chromosome.scaffold.name <- as.factor(embryo_df_tissues$Chromosome.scaffold.name) 
embryo_df_tissues <- embryo_df_tissues %>%
  filter(Chromosome.scaffold.name != "CHR_HSCHR10_1_CTG2" & Chromosome.scaffold.name != "CHR_HSCHR11_1_CTG7"& Chromosome.scaffold.name!= "CHR_HSCHR15_4_CTG8"& Chromosome.scaffold.name!= "CHR_HSCHR22_1_CTG3"& Chromosome.scaffold.name!= "CHR_HSCHR22_1_CTG7"& Chromosome.scaffold.name!=  "CHR_HSCHR4_6_CTG12"& Chromosome.scaffold.name!= "CHR_HSCHR7_2_CTG4_4"& Chromosome.scaffold.name!=  "CHR_HSCHR7_2_CTG6" )
embryo_df_tissues$Chromosome.scaffold.name <- factor(embryo_df_tissues$Chromosome.scaffold.name, levels = c("1", "2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19", "20", "21","22", "X","Y"))

# Nach NA values suchen
sum(is.na(embryo_df_tissues$ensembl.entrez)) # diese Spalte enthält 501 NA - Values
```

Datacleaning complete. Now on to some Exploritory stuff.

# Results

## Limma analysis and Volcano plot

### 1. Limma analysis

```{r}
library(limma)

limma_data = as.data.frame(embryo_df_tissues[1:18], rownames = embryo_df_tissues$ensembl.transcript)

weeks = c("week4", "week5", "week6", "week7", "week8", "week9")
f = factor(c("week4", "week4", "week4", "week5", "week5", "week5", "week6", "week6", "week6", "week7", "week7", "week7", "week8", "week8", "week8", "week9", "week9", "week9"), levels =weeks)
design = model.matrix(~0+f)
colnames(design) =  weeks
fit_2 = lmFit(limma_data, design)
contrast_all = makeContrasts(week9-week8, week9-week7, week9-week6, week9-week5, week9-week4, week8-week7,week8-week6, week8-week5, week8-week4, week7-week6, week7-week5, week7-week4, week6-week5, week6-week4, week5-week4, levels = design)
fit_all = contrasts.fit(fit_2, contrast_all)
fit_all = eBayes(fit_all)
results_all = decideTests(fit_all)
#summary(results_all)


#Create list of all differentially expressed genes
diff_genes_list_0.01 = c()

for (i in 1:15) {
 top.table = topTable(fit_all,i, n = Inf)
 n = sapply(rownames(top.table), function(x){
  embryo_df_tissues$ensembl.transcript[as.numeric(x)]
  })
  row.names(top.table) = n
  diff_genes_list_0.01 = c(diff_genes_list_0.01, rownames(top.table[which(top.table$adj.P.Val < 0.01), ]))
}
length(diff_genes_list_0.01) #4522
diff_genes_list_0.01 = diff_genes_list_0.01[!duplicated(diff_genes_list_0.01)]
length(diff_genes_list_0.01) #1814

#Select differential genes from annotated dataframe
diff_genes_ann_0.01 = embryo_df_tissues[embryo_df_tissues$ensembl.transcript %in% diff_genes_list_0.01, ]

```

```{r}
#List with 5%

diff_genes_list_0.05 = c()

for (i in 1:15) {
 top.table = topTable(fit_all,i, n = Inf)
 n = sapply(rownames(top.table), function(x){
  embryo_df_tissues$ensembl.transcript[as.numeric(x)]
  })
  row.names(top.table) = n
  diff_genes_list_0.05 = c(diff_genes_list_0.05, rownames(top.table[which(top.table$adj.P.Val < 0.05), ]))
}
diff_genes_list_0.05 = diff_genes_list_0.05[!duplicated(diff_genes_list_0.05)]
```










### 2. Volcano plot

The gathered dataset from limma analysis of the differentially expression between week 4 to 9 was used to created a volcano plot. The negativ log10 of the adjusted P-value was ploted against the logFC value. The -log10(adjusted P-value) boundary was set at 2 which equals our targeted our targeted adjusted P-value of 0.01. The logFC boundary was -1 and 1, which reflects a doubling in the expression. The genes were categorized in two groups:

1. up-regulated if the logFC value is larger than 1 and the adjusted P-value is smaller than 0.01
2. down-regulated if the logFC value is smaller than 1 and the adjusted P-value is smaller than 0.01

Gene which didn't belong in those groups were declared as not differentially expressed. The differentially expressed genes between all weeks with an adjusted P-value smaller then 0.01 were further used.

```{r}
# Create a dataset for the volcano plot from the limma analysis
# Ausgabe der Toptabel vom Vergleich Woche 4/9
top.table = topTable(fit_all,5, n = Inf)
head(top.table)

# Create a function for volcano plot
volcanizator <- function(data, logFC_thresh_upper, logFC_thresh_lower, max_pValue){
  
  # Point colours
  mycolours <- c("blue", "red", "black")
  names(mycolours) <- c("DOWN", "UP", "NO")
  
  # Add a column to the data frame to specify if they are UP- or DOWN- regulated (log2FoldChange respectively positive or negative)
  data$diffexpressed <- "NO"
  data$diffexpressed[data$logFC > logFC_thresh_upper & data$adj.P.Val < max_pValue] <- "UP"
  data$diffexpressed[data$logFC < logFC_thresh_lower & data$adj.P.Val < max_pValue] <- "DOWN"
  
  # Create a new column with names of differential expressed genes
  data$delabel <- NA
  #data$delabel[data$diffexpressed != "NO"] <- data$HGNC.symbol[data$diffexpressed != "NO"]
  
  # Plot
  ggplot(data, aes(x=logFC, y=-log10(adj.P.Val))) +
    geom_point(aes(colour = diffexpressed), size=0.9) +
    theme_minimal() +
    geom_text_repel(aes(label = delabel)) + #, force = 5, point.padding	= unit(5, "cm")
    geom_vline(xintercept=c(logFC_thresh_lower, logFC_thresh_upper), col="red") + # log2FoldChange thresholds
    geom_hline(yintercept=-log10(max_pValue), col="red") + # p-value threshold
    scale_colour_manual(values = mycolours) +
    geom_text(aes(label = delabel)) +
    labs(title = paste("Differential gene expression: week 4 to 9"),
         subtitle = "GEO dataset: GSE15744",
         caption = "p Value adjusted: Benjamini & Hochberg (1995)"
         ) +
    xlab("log2FC") +
    ylab("-log10(adj.P.Val)")
}
volcano <- volcanizator(top.table, 1, -1, 0.01)
volcano
```

## Hypothesis: Specific TRAs can be used as key biomarkers for the development of individual organs

### Principal component analysis

Principal component analysis (PCA) was performed on a matrix containing all deferentially expressed genes throughout the 6 weeks. This was performed to reduce dimension while keeping most of the data's variance.

```{r}
#pca on rows (genes)
pca_genes <- prcomp(
  t(diff_genes_ann_0.01[,1:18]), # transposed matrix
  scale. = TRUE # data scaled to have unit variance
  )

#taking a first look
summary(pca_genes)
```

To get a better grasp of how much variance is explained by each PCA the percentage variance of each PCA (scree plot) together with the cumulative variance of the PCAs together was visualized in a plot.

```{r}
#visualizing the variance of the PCAs
pc_eigenvalues <- pca_genes$sdev^2

pc_eigenvalues <- tibble(PC = factor(1:length(pc_eigenvalues)), 
                         variance = pc_eigenvalues) %>% 
  #column with percent variance
  mutate(pct = variance/sum(variance)*100) %>% 
  #column with cumulative variance explained
  mutate(pct_cum = cumsum(pct))


#actual plot
pc_eigenvalues %>% 
  ggplot(aes(x = PC)) +
  geom_col(aes(y = pct)) +
  geom_line(aes(y = pct_cum, group = 1)) + 
  geom_point(aes(y = pct_cum)) +
  labs(x = "Principal component", y = "Fraction variance explained")
```

This visualization helps to determine how many PCAs are needed to explain a significant amount of the data's variation. The chosen PCAs can than be used for further analysis. Seeing as the first three PCAs already explain over 80% of the data's variance, only those three were chosen to be used for further analysis and visualization.

The first three PCAs were now plotted against each other. This helps to analyze the genes contributions to the PCAs. The more parallel a gene's vector is to the PCA axis, the more the gene contributes to that PCA. The lenght of the vectors shows how much variability of the gene is explained py the PCAs. The longer the vector, the better it is represented in this dimension. The angels between the vectors give insight about the correlation between the genes. Small angels demonstrate a high correlation whereas opposite angles demonstrate a high negative correlation.

```{r}
#PCA 1&2
ggbiplot(pca_genes)

#PCA 2&3
ggbiplot(pca_genes, choices=c(2,3))

#PCA 1&3
ggbiplot(pca_genes, choices=c(1,3))
```


## Hypothesis: Neural TRA expression patterns reflect morphological brain development

The annotated dataset after limma analysis was filtered to determine which genes which genes are differentially expressed in a certain tissue the discovered genes were exermined with NCBI to determine their function. The interesting genes are categorized in three groups: 

1.Genes Ion channels
2.Genes for neuronal development
3.Genes for cytokine

### 1. Ion channels

```{r}
# A vektor of ENST numbers and weeks was created
ENST = embryo_df_tissues$ensembl.transcript
week = c(4,5,6,7,8,9)

# ENST00000531293
data.ENST00000531293 = as.data.frame(embryo_df_tissues %>%
                             filter(ensembl.transcript == str_extract(ENST, "ENST00000531293")))
data.ENST00000531293 = data.ENST00000531293[,1:18]
week_4 =data.ENST00000531293[1:3]
week_4 = apply(week_4,1,median)
week_5 =data.ENST00000531293[4:6]
week_5 = apply(week_5,1,median)
week_6 =data.ENST00000531293[7:9]
week_6 = apply(week_6,1,median)
week_7 =data.ENST00000531293[10:12]
week_7 = apply(week_7,1,median)
week_8 =data.ENST00000531293[13:15]
week_8 = apply(week_8,1,median)
week_9 =data.ENST00000531293[16:18]
week_9 = apply(week_9,1,median)
data.ENST00000531293 = c(week_4,week_5,week_6,week_7,week_8,week_9)
data.ENST00000531293 =cbind(data.ENST00000531293,week)

# Summary
plot(data.ENST00000531293[,2],data.ENST00000531293[,1],type = "b",lwd=1,pch=19, main = "Geneexpression level during week 4 to 9", xlab = "weeks",ylab = "Expressionlevel",col = "red")
par(new=TRUE)
legend(3.8, 9.25, legend=c("ENST00000531293"),
       col=c("red"), lty=1, cex=0.8,title="Expressed genes")
```
Ion channels play an important role in the function of neurons. We discovered that ENST00000531293 is highly expressed in Nucleus accumbens. It shows a signifikant increase between week 7 to 9 and codes for SLN sarcolipin which is a Sarcoplasmic reticulum Ca(2+)-ATPases.  

### 2. Genes for neuronal development and function

```{r}
# ENST00000602349
data.ENST00000602349 = as.data.frame(embryo_df_tissues %>%
                             filter(ensembl.transcript == str_extract(ENST, "ENST00000602349")))
data.ENST00000602349 = data.ENST00000602349[,1:18]
week_4 =data.ENST00000602349[1:3]
week_4 = apply(week_4,1,median)
week_5 =data.ENST00000602349[4:6]
week_5 = apply(week_5,1,median)
week_6 =data.ENST00000602349[7:9]
week_6 = apply(week_6,1,median)
week_7 =data.ENST00000602349[10:12]
week_7 = apply(week_7,1,median)
week_8 =data.ENST00000602349[13:15]
week_8 = apply(week_8,1,median)
week_9 =data.ENST00000602349[16:18]
week_9 = apply(week_9,1,median)
data.ENST00000602349 = c(week_4,week_5,week_6,week_7,week_8,week_9) 
data.ENST00000602349 =cbind(data.ENST00000602349,week)

# ENST00000276646 & ENST00000529690
data.ENST00000276646 = as.data.frame(embryo_df_tissues %>%
                             filter(ensembl.transcript == str_extract(ENST, "ENST00000276646")))
data.ENST00000276646 = data.ENST00000276646[,1:18]
week_4 =data.ENST00000276646[1:3]
week_4 = apply(week_4,1,median)
week_5 =data.ENST00000276646[4:6]
week_5 = apply(week_5,1,median)
week_6 =data.ENST00000276646[7:9]
week_6 = apply(week_6,1,median)
week_7 =data.ENST00000276646[10:12]
week_7 = apply(week_7,1,median)
week_8 =data.ENST00000276646[13:15]
week_8 = apply(week_8,1,median)
week_9 =data.ENST00000276646[16:18]
week_9 = apply(week_9,1,median)
data.ENST00000276646 = c(week_4,week_5,week_6,week_7,week_8,week_9) 
data.ENST00000276646 =cbind(data.ENST00000276646,week)

data.ENST00000529690 = as.data.frame(embryo_df_tissues %>%
                             filter(ensembl.transcript == str_extract(ENST, "ENST00000529690")))
data.ENST00000529690 = data.ENST00000529690[,1:18]
week_4 =data.ENST00000529690[1:3]
week_4 = apply(week_4,1,median)
week_5 =data.ENST00000529690[4:6]
week_5 = apply(week_5,1,median)
week_6 =data.ENST00000529690[7:9]
week_6 = apply(week_6,1,median)
week_7 =data.ENST00000529690[10:12]
week_7 = apply(week_7,1,median)
week_8 =data.ENST00000529690[13:15]
week_8 = apply(week_8,1,median)
week_9 =data.ENST00000529690[16:18]
week_9 = apply(week_9,1,median)
data.ENST00000529690 = c(week_4,week_5,week_6,week_7,week_8,week_9) 
data.ENST00000529690 =cbind(data.ENST00000529690,week)

# ENST00000356660
data.ENST00000356660 = as.data.frame(embryo_df_tissues %>%
                             filter(ensembl.transcript == str_extract(ENST, "ENST00000356660")))
data.ENST00000356660 = data.ENST00000356660[,1:18]
week_4 =data.ENST00000356660[1:3]
week_4 = apply(week_4,1,median)
week_5 =data.ENST00000356660[4:6]
week_5 = apply(week_5,1,median)
week_6 =data.ENST00000356660[7:9]
week_6 = apply(week_6,1,median)
week_7 =data.ENST00000356660[10:12]
week_7 = apply(week_7,1,median)
week_8 =data.ENST00000356660[13:15]
week_8 = apply(week_8,1,median)
week_9 =data.ENST00000356660[16:18]
week_9 = apply(week_9,1,median)
data.ENST00000356660 = c(week_4,week_5,week_6,week_7,week_8,week_9) 
data.ENST00000356660 =cbind(data.ENST00000356660,week)

# ENST00000518312 & ENST00000521485
data.ENST00000518312 = as.data.frame(embryo_df_tissues %>%
                             filter(ensembl.transcript == str_extract(ENST, "ENST00000518312")))
data.ENST00000518312 = data.ENST00000518312[,1:18]
week_4 =data.ENST00000518312[1:3]
week_4 = apply(week_4,1,median)
week_5 =data.ENST00000518312[4:6]
week_5 = apply(week_5,1,median)
week_6 =data.ENST00000518312[7:9]
week_6 = apply(week_6,1,median)
week_7 =data.ENST00000518312[10:12]
week_7 = apply(week_7,1,median)
week_8 =data.ENST00000518312[13:15]
week_8 = apply(week_8,1,median)
week_9 =data.ENST00000518312[16:18]
week_9 = apply(week_9,1,median)
data.ENST00000518312 = c(week_4,week_5,week_6,week_7,week_8,week_9) 
data.ENST00000518312 =cbind(data.ENST00000518312,week)

data.ENST00000521485 = as.data.frame(embryo_df_tissues %>%
                             filter(ensembl.transcript == str_extract(ENST, "ENST00000521485")))
data.ENST00000521485 = data.ENST00000521485[,1:18]
week_4 =data.ENST00000521485[1:3]
week_4 = apply(week_4,1,median)
week_5 =data.ENST00000521485[4:6]
week_5 = apply(week_5,1,median)
week_6 =data.ENST00000521485[7:9]
week_6 = apply(week_6,1,median)
week_7 =data.ENST00000521485[10:12]
week_7 = apply(week_7,1,median)
week_8 =data.ENST00000521485[13:15]
week_8 = apply(week_8,1,median)
week_9 =data.ENST00000521485[16:18]
week_9 = apply(week_9,1,median)
data.ENST00000521485 = c(week_4,week_5,week_6,week_7,week_8,week_9) 
data.ENST00000521485 =cbind(data.ENST00000521485,week)

# ENST00000577440
data.ENST00000577440 = as.data.frame(embryo_df_tissues %>%
                             filter(ensembl.transcript == str_extract(ENST, "ENST00000577440")))
data.ENST00000577440 = data.ENST00000577440[,1:18]
week_4 =data.ENST00000577440[1:3]
week_4 = apply(week_4,1,median)
week_5 =data.ENST00000577440[4:6]
week_5 = apply(week_5,1,median)
week_6 =data.ENST00000577440[7:9]
week_6 = apply(week_6,1,median)
week_7 =data.ENST00000577440[10:12]
week_7 = apply(week_7,1,median)
week_8 =data.ENST00000577440[13:15]
week_8 = apply(week_8,1,median)
week_9 =data.ENST00000577440[16:18]
week_9 = apply(week_9,1,median)
data.ENST00000577440 = c(week_4,week_5,week_6,week_7,week_8,week_9) 
data.ENST00000577440 =cbind(data.ENST00000577440,week)

# ENST00000439476
data.ENST00000439476 = as.data.frame(embryo_df_tissues %>%
                             filter(ensembl.transcript == str_extract(ENST, "ENST00000439476")))
data.ENST00000439476 = data.ENST00000439476[,1:18]
week_4 =data.ENST00000439476[1:3]
week_4 = apply(week_4,1,median)
week_5 =data.ENST00000439476[4:6]
week_5 = apply(week_5,1,median)
week_6 =data.ENST00000439476[7:9]
week_6 = apply(week_6,1,median)
week_7 =data.ENST00000439476[10:12]
week_7 = apply(week_7,1,median)
week_8 =data.ENST00000439476[13:15]
week_8 = apply(week_8,1,median)
week_9 =data.ENST00000439476[16:18]
week_9 = apply(week_9,1,median)
data.ENST00000439476 = c(week_4,week_5,week_6,week_7,week_8,week_9) 
data.ENST00000439476 =cbind(data.ENST00000439476,week)


# ENST00000539563
data.ENST00000539563 = as.data.frame(embryo_df_tissues %>%
                             filter(ensembl.transcript == str_extract(ENST, "ENST00000539563")))
data.ENST00000539563 = data.ENST00000539563[,1:18]
week_4 =data.ENST00000539563[1:3]
week_4 = apply(week_4,1,median)
week_5 =data.ENST00000539563[4:6]
week_5 = apply(week_5,1,median)
week_6 =data.ENST00000539563[7:9]
week_6 = apply(week_6,1,median)
week_7 =data.ENST00000539563[10:12]
week_7 = apply(week_7,1,median)
week_8 =data.ENST00000539563[13:15]
week_8 = apply(week_8,1,median)
week_9 =data.ENST00000539563[16:18]
week_9 = apply(week_9,1,median)
data.ENST00000539563 = c(week_4,week_5,week_6,week_7,week_8,week_9) 
data.ENST00000539563 =cbind(data.ENST00000539563,week)

# Summary
plot(data.ENST00000602349[,2],data.ENST00000602349[,1],type = "b",lwd=1,pch=19, main = "Geneexpression level during week 4 to 9", xlab = "weeks",ylab = "Expressionlevel",col = "red", ylim = c(6.3,8.4))
par(new=TRUE)
plot(data.ENST00000276646[,2],data.ENST00000276646[,1],type = "b",lwd=1,pch=19, main = "Geneexpression level during week 4 to 9", xlab = "weeks",ylab = "Expressionlevel",col = "blue", ylim = c(6.3,8.4)) 
par(new=TRUE)
plot(data.ENST00000529690[,2],data.ENST00000529690[,1],type = "b",lwd=1,pch=19, main = "Geneexpression level during week 4 to 9", xlab = "weeks",ylab = "Expressionlevel",col = "orange", ylim = c(6.3,8.4))
par(new=TRUE)
plot(data.ENST00000356660[,2],data.ENST00000356660[,1],type = "b",lwd=1,pch=19, main = "Geneexpression level during week 4 to 9", xlab = "weeks",ylab = "Expressionlevel",col = "green", ylim =c(6.3,8.4))
par(new=TRUE)
plot(data.ENST00000518312[,2],data.ENST00000518312[,1],type = "b",lwd=1,pch=19, main = "Geneexpression level during week 4 to 9", xlab = "weeks",ylab = "Expressionlevel",col = "black", ylim = c(6.3,8.4))
par(new=TRUE)
plot(data.ENST00000521485[,2],data.ENST00000521485[,1],type = "b",lwd=1,pch=19, main = "Geneexpression level during week 4 to 9", xlab = "weeks",ylab = "Expressionlevel",col = "pink", ylim = c(6.3,8.4)) 
par(new=TRUE)
plot(data.ENST00000577440[,2],data.ENST00000577440[,1],type = "b",lwd=1,pch=19, main = "Geneexpression level during week 4 to 9", xlab = "weeks",ylab = "Expressionlevel",col = "purple", ylim = c(6.3,8.4))
par(new=TRUE)
plot(data.ENST00000439476[,2],data.ENST00000439476[,1],type = "b",lwd=1,pch=19, main = "Geneexpression level during week 4 to 9", xlab = "weeks",ylab = "Expressionlevel",col = "salmon", ylim = c(6.3,8.4))
par(new=TRUE)
plot(data.ENST00000539563[,2],data.ENST00000539563[,1],type = "b",lwd=1,pch=19, main = "Geneexpression level during week 4 to 9", xlab = "weeks",ylab = "Expressionlevel",col = "yellowgreen", ylim = c(6.3,8.4))
legend(3.8, 8.5, legend=c("ENST00000602349", "ENST00000276646", "ENST00000529690", "ENST00000356660", "ENST00000518312", "ENST00000521485", "ENST00000577440", "ENST00000439476", "ENST00000539563"),
       col=c("red", "blue", "orange", "green","black", "pink", "purple", "salmon", "yellowgreen"), lty=1, cex=0.8,title="Expressed genes")

```



The second groupe are genes with a specific function in the neuronal development and function. 

#### 2.1 Genes for neuronal function

Therefore we discovered that ENST00000276646 and ENST00000529690 show an signifikant increase in gene expression over the weeks. Both genes were connected to the Cerebellar Hemisphere and were associated with SYBU (syntabulin). SYBU plays an important role in  which contibutes activity-dependent presynaptic assembly in neuronal development.

#### 2.2 Genes for axon guidance

Filtering mentioned four genes for axon guidance:

ENST00000602349 codes for NXPH1 (neurexophilin 1) which forms a thight complex with neurexins. Neurexins promote the adhesion between axons and dendrites. ENST00000602349 shows a strong increase, especially between week 7 to 8 and is connected to Anterior cingulate cortex.

ENST00000518312 and ENST00000521485 encode for SNAP91 (synaptosome associated protein 91) which interacts in regulation of clathrin-dependent endocytosis. Therefore SNAP91 is important for axonal functions of neurons like postsynaptic density. ENST00000518312 & ENST00000521485 were associated with Cerebellar Hemisphere and show also signifikant increase between week 7 to 8.

In addition ENST00000539563, encoding for LSAMP (limbic system associated membrane protein) interacts in axon guidance. The encoded preprotein is processed to neuronal surface glycoprotein which interacts as an adhesion molecule during axon guidance and neuronal growth in the developing limbic system. ENST00000539563 is associated to Putamen which is grouped in basal ganglia. Basal ganglia were associated with the lymbic system.

#### 2.3 Genes for neuronal survival

ENST00000356660 and ENST00000439476 code for BDNF (brain derived neurotrophic factor). A binding of BDNF to its receptor promotes neuronal survival. Both genes show an identical decline in expression over the weeks. Nevertheles, ENST00000356660 is connected to Cerebellar Hemisphere and ENST00000439476 to Hippocampus.

#### 2.4 Brain associated gene

Finally ENST00000577440 encoding for SEPTIN4 (septin 4) was identified. SEPTIN4 may regulate cytoskeletal organization. A defekt septin function disturbs cytokinesis. ENST00000577440 is connected to Cerebellar Hemisphere and shows a signifikant increase between week 7 to 9.


### 3.Genes for cytokine

```{r}
# ENST00000337225
data.ENST00000337225 = as.data.frame(embryo_df_tissues %>%
                             filter(ensembl.transcript == str_extract(ENST, "ENST00000337225")))
data.ENST00000337225 = data.ENST00000337225[,1:18]
week_4 =data.ENST00000337225[1:3]
week_4 = apply(week_4,1,median)
week_5 =data.ENST00000337225[4:6]
week_5 = apply(week_5,1,median)
week_6 =data.ENST00000337225[7:9]
week_6 = apply(week_6,1,median)
week_7 =data.ENST00000337225[10:12]
week_7 = apply(week_7,1,median)
week_8 =data.ENST00000337225[13:15]
week_8 = apply(week_8,1,median)
week_9 =data.ENST00000337225[16:18]
week_9 = apply(week_9,1,median)
data.ENST00000337225 = c(week_4,week_5,week_6,week_7,week_8,week_9) 
data.ENST00000337225 =cbind(data.ENST00000337225,week)

# ENST00000579298
data.ENST00000579298 = as.data.frame(embryo_df_tissues %>%
                             filter(ensembl.transcript == str_extract(ENST, "ENST00000579298")))
data.ENST00000579298 = data.ENST00000579298[,1:18]
week_4 =data.ENST00000579298[1:3]
week_4 = apply(week_4,1,median)
week_5 =data.ENST00000579298[4:6]
week_5 = apply(week_5,1,median)
week_6 =data.ENST00000579298[7:9]
week_6 = apply(week_6,1,median)
week_7 =data.ENST00000579298[10:12]
week_7 = apply(week_7,1,median)
week_8 =data.ENST00000579298[13:15]
week_8 = apply(week_8,1,median)
week_9 =data.ENST00000579298[16:18]
week_9 = apply(week_9,1,median)
data.ENST00000579298 = c(week_4,week_5,week_6,week_7,week_8,week_9) 
data.ENST00000579298 =cbind(data.ENST00000579298,week)

# ENST00000555247
data.ENST00000555247 = as.data.frame(embryo_df_tissues %>%
                             filter(ensembl.transcript == str_extract(ENST, "ENST00000555247")))
data.ENST00000555247 = data.ENST00000555247[,1:18]
week_4 =data.ENST00000555247[1:3]
week_4 = apply(week_4,1,median)
week_5 =data.ENST00000555247[4:6]
week_5 = apply(week_5,1,median)
week_6 =data.ENST00000555247[7:9]
week_6 = apply(week_6,1,median)
week_7 =data.ENST00000555247[10:12]
week_7 = apply(week_7,1,median)
week_8 =data.ENST00000555247[13:15]
week_8 = apply(week_8,1,median)
week_9 =data.ENST00000555247[16:18]
week_9 = apply(week_9,1,median)
data.ENST00000555247 = c(week_4,week_5,week_6,week_7,week_8,week_9) 
data.ENST00000555247 =cbind(data.ENST00000555247,week)

# ENST00000590261
data.ENST00000590261 = as.data.frame(embryo_df_tissues %>%
                             filter(ensembl.transcript == str_extract(ENST, "ENST00000590261")))
data.ENST00000590261 = data.ENST00000590261[,1:18]
week_4 =data.ENST00000590261[1:3]
week_4 = apply(week_4,1,median)
week_5 =data.ENST00000590261[4:6]
week_5 = apply(week_5,1,median)
week_6 =data.ENST00000590261[7:9]
week_6 = apply(week_6,1,median)
week_7 =data.ENST00000590261[10:12]
week_7 = apply(week_7,1,median)
week_8 =data.ENST00000590261[13:15]
week_8 = apply(week_8,1,median)
week_9 =data.ENST00000590261[16:18]
week_9 = apply(week_9,1,median)
data.ENST00000590261 = c(week_4,week_5,week_6,week_7,week_8,week_9) 
data.ENST00000590261 =cbind(data.ENST00000590261,week)

# Summary
plot(data.ENST00000337225[,2],data.ENST00000337225[,1],type = "b",lwd=1,pch=19, main = "Geneexpression level during week 4 to 9", xlab = "weeks",ylab = "Expressionlevel",col = "red",ylim = c(7.6,9.7))
par(new=TRUE)
plot(data.ENST00000579298[,2],data.ENST00000579298[,1],type = "b",lwd=1,pch=19, main = "Geneexpression level during week 4 to 9", xlab = "weeks",ylab = "Expressionlevel",col = "blue",ylim = c(7.6,9.7)) 
par(new=TRUE)
plot(data.ENST00000555247[,2],data.ENST00000555247[,1],type = "b",lwd=1,pch=19, main = "Geneexpression level during week 4 to 9", xlab = "weeks",ylab = "Expressionlevel",col = "orange",ylim = c(7.6,9.7))
par(new=TRUE)
plot(data.ENST00000590261[,2],data.ENST00000590261[,1],type = "b",lwd=1,pch=19, main = "Geneexpression level during week 4 to 9", xlab = "weeks",ylab = "Expressionlevel",col = "green", ylim = c(7.6,9.7))
legend(3.8, 9.8, legend=c("ENST00000337225", "ENST00000579298", "ENST00000555247", "ENST00000590261"),
       col=c("red", "blue", "orange", "green"), lty=1, cex=0.8,title="Expressed genes")
```

Cytokines are important signaling molecules. Especially chemokines are ment to take part in signaling process during neuronal development.

*Paper nennen*

#### 3.1 Interleukin related genes

Two interleukin related genes were discovered. ENST00000555247 encodes for IL11RA (interleukin 11 receptor subunit alpha) which is a receptor for the cytokine, Interleukin 11.  The IL-11 receptor is a member of the hematopoietic cytokine receptor family. ENST00000555247 is connected to Spinal cord and shows a signifikant increase in expression during week 4 to 8.
ENST00000590261 encodes for LF3 (interleukin enhancer binding factor 3) and forms a heterodimer with a 45 kDa transcription factor. This complex is necassary for T-cell expression of interleukin 2. ENST00000590261 is related to Substantia nigra and shows a decline over the weeks.

#### 3.2 Chemokine related genes

There are many research targeting the role of chemokines during neuronal development. We discovered ENST00000337225 which encodes for CXCL14 (C-X-C motif chemokine ligand 14). CXCL14 is structurally related to the CXC (Cys-X-Cys) subfamily of cytokines.which means two cysteines separated by a single amino acid. ENST00000337225 shows a signifikant increase in expression between week 4 to 6 and is related to Anterior cingulate cortex.
ENST00000579298 encodes for NUP85 (nucleoporin 85) a protein component of the Nup107-160 subunit of the nuclear pore complex. NUP85 can bind to CCR2 (a receptor for C-C motif chemokines) and promote chemotaxis of monocytes. ENST00000579298 is related to the Frontal Cortex and shows a decline between week 5 to 9.

## TRAs can infer a basic timeline of organ development

### Differentially expressed transcripts can be linked to all analyzed tissues

The TRA Data cover 53 distinct tissues. For all of those, we found at least 40 differentially expressed transcripts within our dataset. The minimum was found with 46 stomach-linked transcripts, the maximum were 837 TRAs for the testes. 

```{r, fig.width=8, fig.height=6}
# Create a barplot for the TRA count of each tissue based on our dataset of differentially expressed genes

all_tissues = c("Adipose - Subcutaneous", "Adipose - Visceral", "Cells - Transformed fibroblasts", "Skin - Not Sun Exposed", "Skin - Sun Exposed",  "Muscle - Skeletal", "Bladder", "Kidney - Cortex", "Colon - Sigmoid", "Colon - Transverse", "Esophagus - Gastroesophageal Junction", "Esophagus - Mucosa", "Esophagus - Muscularis", "Liver", "Minor Salivary Gland", "Pancreas", "Small Intestine - Terminal Ileum", "Spleen", "Stomach", "Breast - Mammary Tissue", "Cervix - Ectocervix", "Cervix - Endocervix",  "Fallopian Tube", "Ovary", "Uterus", "Vagina", "Prostate", "Testis", "Adrenal Gland", "Pituitary", "Thyroid", "Artery - Aorta", "Artery - Coronary", "Artery - Tibial", "Heart - Atrial Appendage", "Heart - Left Ventricle", "Lung", "Whole Blood", "Cells - EBV-transformed lymphocytes", "Brain - Amygdala", "Brain - Anterior cingulate cortex", "Brain - Caudate", "Brain - Cerebellar Hemisphere", "Brain - Cerebellum", "Brain - Cortex", "Brain - Frontal Cortex", "Brain - Hippocampus", "Brain - Hypothalamus", "Brain - Nucleus accumbens", "Brain - Putamen", "Brain - Spinal cord", "Brain - Substantia nigra",  "Nerve - Tibial")
tissue_count = data.frame(tissue = all_tissues, count = sapply(all_tissues, function(y) {sum(sapply(diff_genes_ann_0.01$tissues, function(x) {grepl(y, toString(x))}))}))

tissue_count_barplot =  ggplot(tissue_count, aes(x = tissue, y = count, fill = tissue))  + geom_bar(stat = "identity") + labs(x = "Tissue", y = "Number of Transcripts")  + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) + guides(fill = FALSE) 
```

```{r, fig.width=7, fig.height=7}
library(ggplot2)
library(treemapify)

select_tissues = c("Adipose", "Cells - Transformed fibroblasts", "Skin",  "Muscle - Skeletal", "Bladder", "Kidney - Cortex",  "Colon", "Esophagus", "Liver", "Minor Salivary Gland", "Pancreas", "Small Intestine - Terminal Ileum", "Spleen", "Stomach", "Breast - Mammary Tissue", "Cervix", "Fallopian Tube", "Ovary", "Uterus", "Vagina", "Prostate", "Testis", "Adrenal Gland", "Pituitary", "Thyroid",  "Artery", "Heart", "Lung", "Whole Blood", "Cells - EBV-transformed lymphocytes", "Brain - Spinal cord", "Brain", "Nerve - Tibial")



count_data = data.frame(tissue = select_tissues, count = NA)
for (tissue in select_tissues){
  
  count_data[count_data$tissue == tissue, "count"] = sum(bool_contained = sapply(diff_genes_ann_0.01$tissues, function(x) {grepl(tissue, toString(x))}))

}
cols = rainbow(33, s=.6, v=.9) #[sample(1:33,33)] #61
count_data$color = cols
count_data
treemap = ggplot(count_data, aes(area = count, label = tissue, fill = tissue)) + geom_treemap() + geom_treemap_text(colour = "white", place = "top", reflow = T) + scale_fill_manual(values=cols) + guides(fill = FALSE)
```


```{r, fig.width=9, fig.height=6}
library(grid)
library(gridExtra)
lay = rbind(c(1,1,2), c(1,1, NA))
grid.arrange(grobs = list(tissue_count_barplot, treemap),layout_matrix = lay, top = "Differentially expressed transcripts of TRAs by tissue")
```
```{r}
# Mean number of tissues associated with each transcript
mean(sapply(diff_genes_ann_0.01$tissues, function(x) {length(x)}))
```

This numbers are sufficient for further analysis of the gene expression within individual tissues. Nonetheless, it should be noted that there is significant overlap between the TRAs associated with different tissues, especially since each transcript is on average linked to 7.4 different sub-tissues or tissues. This overlap is further illustrated by fig. ????. 

```{r,fig.width=12, fig.height=8}
library(igraph)
library(tidyverse)
library(ggnet)
library(viridis)

nodes = c("Adipose", "Cells - Transformed fibroblasts", "Skin",  "Muscle - Skeletal", "Bladder", "Kidney - Cortex",  "Colon", "Esophagus", "Liver", "Minor Salivary Gland", "Pancreas", "Small Intestine - Terminal Ileum", "Spleen", "Stomach", "Breast - Mammary Tissue", "Cervix", "Fallopian Tube", "Ovary", "Uterus", "Vagina", "Prostate", "Testis", "Adrenal Gland", "Pituitary", "Thyroid",  "Artery", "Heart", "Lung", "Whole Blood", "Cells - EBV-transformed lymphocytes", "Brain - Spinal cord", "Brain", "Nerve - Tibial")

edges = data.frame (rep(nodes, 32), NA)
for (i in 1:32) {
  a = c(edges[(i+1):33,1], edges[1:i,1])
  edges[(33*(i-1)+1):(33*i),2] = a
}
colnames(edges) = c("Tissue1", "Tissue2")
edges
graph1 = graph_from_data_frame(edges, directed = FALSE)
plot(graph1)


node_weight = data.frame(tissue = nodes, weight = sapply(nodes, function(y) {sum(sapply(diff_genes_ann_0.01$tissues, function(x) {grepl(y, toString(x))}))}))

edge_combined = edges %>% unite(tissues, c("Tissue1", "Tissue2"), sep = "|")
edge_combined
edge_weight = data.frame(edges, weight = apply(edges,1, function(y) {sum(sapply(diff_genes_ann_0.01$tissues, function(x) {grepl(y[1], toString(x)) && grepl(y[2], toString(x))}))}))

show(edge_weight)
min(edge_weight$weight)
edge_weight_adj = edge_weight
edge_weight_adj$weight = sapply(edge_weight_adj$weight, function(x) { if(x < 100) {x = 0} else {x = x/100}})
edge_weight_cleared = edge_weight_adj[!(edge_weight_adj$weight == 0),]

edge_weight_cleared

graph2 = ggnet2(edge_weight_cleared[,1:2], label = TRUE, edge.size = edge_weight_cleared$weight)
node_size = sapply(graph2$data$label, function(x) {node_weight[x,2]})

graph2 = ggnet2(edge_weight_cleared[,1:2], color = graph2$data$label, label = TRUE, color.palette = c() ,edge.size = edge_weight_cleared$weight, size = (ceiling(node_size/30))) + guides(size = FALSE, color = FALSE) + scale_color_viridis(option = "D", discrete = TRUE)
graph2
```

```{r, fig.width=14, fig.height=14}
library(pheatmap)

tissues =  c("Adipose", "Cells - Transformed fibroblasts", "Skin",  "Muscle - Skeletal", "Bladder", "Kidney - Cortex",  "Colon", "Esophagus", "Liver", "Minor Salivary Gland", "Pancreas", "Small Intestine - Terminal Ileum", "Spleen", "Stomach", "Breast - Mammary Tissue", "Cervix", "Fallopian Tube", "Ovary", "Uterus", "Vagina", "Prostate", "Testis", "Adrenal Gland", "Pituitary", "Thyroid",  "Artery", "Heart", "Lung", "Whole Blood", "Cells - EBV-transformed lymphocytes", "Brain - Spinal cord", "Brain", "Nerve - Tibial")
weights = matrix(nrow =length(tissues), ncol = length(tissues))
rownames(weights) = tissues
colnames(weights) = tissues
for (i in 1:33) {
  for (j in 1:33) {
    weights[i,j] = sum(sapply(diff_genes_ann_0.01$tissues, function(x) {grepl(tissues[i], toString(x)) && grepl(tissues[j], toString(x))}))
  }
} 
weights2 = log2(weights)
heatmap_links = pheatmap(weights2, display_numbers = TRUE, fontsize_number = 8, legend = TRUE)
heatmap_links
```


```{r, fig.width=14, fig.height=14}
# Jetzt mit prozentualem Anteil 
library(pheatmap)

tissues =  c("Adipose", "Cells - Transformed fibroblasts", "Skin",  "Muscle - Skeletal", "Bladder", "Kidney - Cortex",  "Colon", "Esophagus", "Liver", "Minor Salivary Gland", "Pancreas", "Small Intestine - Terminal Ileum", "Spleen", "Stomach", "Breast - Mammary Tissue", "Cervix", "Fallopian Tube", "Ovary", "Uterus", "Vagina", "Prostate", "Testis", "Adrenal Gland", "Pituitary", "Thyroid",  "Artery", "Heart", "Lung", "Whole Blood", "Cells - EBV-transformed lymphocytes", "Brain - Spinal cord", "Brain", "Nerve - Tibial")

node_weight = data.frame(tissue = tissue, weight = sapply(nodes, function(y) {sum(sapply(diff_genes_ann_0.01$tissues, function(x) {grepl(y, toString(x))}))}))

weights = matrix(nrow =length(tissues), ncol = length(tissues))
rownames(weights) = tissues
colnames(weights) = tissues
for (i in 1:33) {
  for (j in 1:33) {
    weights[i,j] = (sum(sapply(diff_genes_ann_0.01$tissues, function(x) {grepl(tissues[i], toString(x)) && grepl(tissues[j], toString(x))}))/node_weight[i,2])
  }
} 

heatmap_links = pheatmap(weights, display_numbers = TRUE, fontsize_number = 8, legend = TRUE, breaks = c(seq(0,0.4,0.005), seq(0.41, 0.8, 0.025), 0.85, 0.9, 0.95,1))
heatmap_links
```





# Discussion

## Hypothesis: Specific TRAs can be used as key biomarkers for the development of individual organs


## Hypothesis: Neural TRA expression patterns reflect morphological brain development


## Hypothesis: TRAs can infer a timeline of organ development similar to the results by Yi et al. 2010





